<%- include('../partials/mainheader.ejs')%>

    <style>
        .data-cell {
            padding-left: 50px;
            padding-top: 20;
        }

        .table-data {
            padding-right: 200px;
        }

        .save-btn {
            background-color: rgb(219, 99, 0);
            border: none;
            width: 150px;
            height: 40px;
        }
    </style>

    <div class="checkout-main-area pb-100 pt-70">
        <div class="container">
            <div class="customer-zone mb-20">
                <p class="cart-page-title">
                    Returning customer?
                    <a class="checkout-click1" href="#">Click here to login</a>
                </p>
                <div class="checkout-login-info">
                    <p>
                        If you have shopped with us before, please enter your details in the
                        boxes below. If you are a new customer, please proceed to the Billing
                        & Shipping section.
                    </p>
                    <form action="#">
                        <div class="row">
                            <div class="col-lg-6 col-md-6">
                                <div class="sin-checkout-login">
                                    <label>Username or email address <span>*</span></label>
                                    <input type="text" name="user-name" />
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6">
                                <div class="sin-checkout-login">
                                    <label>Passwords <span>*</span></label>
                                    <input type="password" name="user-password" />
                                </div>
                            </div>
                        </div>
                        <div class="button-remember-wrap">
                            <button class="button" type="submit">Login</button>
                            <div class="checkout-login-toggle-btn">
                                <input type="checkbox" />
                                <label>Remember me</label>
                            </div>
                        </div>
                        <div class="lost-password">
                            <a href="#">Lost your password?</a>
                        </div>
                    </form>
                </div>
            </div>
            <div class="customer-zone mb-20">
                <p class="cart-page-title">
                    Have a coupon?
                    <a class="checkout-click3" href="#">Click here to enter your code</a>
                </p>
                <div class="checkout-login-info3">
                    <form action="#">
                        <input type="text" placeholder="Coupon code" />
                        <input type="submit" value="Apply Coupon" />
                    </form>
                </div>
            </div>

            <div class="checkout-wrap pt-50">
                <div class="row">
                    <div class="col-lg-7">
                        <div class="billing-info-wrap">
                            <h3>Billing Details</h3>

                            <div class="checkout-account" style="
                background-color: #eeeff2;
                width: 100%;
                height: 50px;
                padding-top: 15px;
                padding-left: 10px;
              ">
                                <input class="checkout-toggle" type="checkbox" />
                                <span>Ship to a different address?</span>
                            </div>
                            <form  action="/adduseraddress" method="post">
                                <div class="different-address open-toggle mt-30">
                                    <div class="row">
                                        <div class="col-lg-6 col-md-6">
                                            <div class="billing-info mb-20">
                                                <label>User Name</label>
                                                <input type="text" placeholder="(Name)*" name="username"/>
                                            </div>
                                        </div>
                                        <div class="col-lg-6 col-md-6">
                                            <div class="billing-info mb-20">
                                                <label>Mobile Number</label>
                                                <input type="text" placeholder="(10 Digits )*"  name="usermobile"/>
                                            </div>
                                        </div>
                                        <div class="col-lg-12">
                                            <div class="billing-info mb-20">
                                                <label>Address</label>
                                                <input type="text" placeholder="(House No. Building Name)*" name="address"/>
                                            </div>
                                        </div>

                                        <div class="col-lg-12">
                                            <div class="billing-info mb-20">
                                                <label>Street Address</label>
                                               
                                                <input placeholder="(Road name,Area, colony)*" type="text"  name="streetaddress" />
                                            </div>
                                        </div>
                                        <div class="col-lg-12">
                                            <div class="billing-info mb-20">
                                                <label>Pincode</label>
                                                <input type="text" placeholder="(Required)*" name="pincode"/>
                                            </div>
                                        </div>
                                        <div class="col-lg-6 col-md-6">
                                            <div class="billing-info mb-20">
                                                <label>City</label>
                                                <input type="text" placeholder="(your city)*" name="city"/>
                                            </div>
                                        </div>
                                        <div class="col-lg-6 col-md-6">
                                            <div class="billing-info mb-20">
                                                <label>State</label>
                                                <input type="text" placeholder="(State)*" name="state"/>
                                            </div>
                                        </div>
                                        <div class="col-lg-6 col-md-6">
                                            <div class="billing-info mb-20">
                                                <label>Landmark</label>
                                                <input type="text" placeholder="(Famous place your Area)*"  name="landmark" />
                                            </div>
                                        </div>

                                        <div class="single-input-item btn-hover">
                                            <button type="submit" class="save-btn sqr-btn">
                                                Add New Address
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                            <% if(addressData.length> 0){ %>
                                <% addressData.forEach(data=>{%>

                                    <table style="
                width: 90%;
                height: 300px;
                background-color: rgb(255, 255, 255);
                box-shadow: 0px 10px 20px rgba(0, 0, 0, 0.1),
                  0px 6px 6px rgba(0, 0, 0, 0.1);
              ">
                                        <tr>
                                            <th class="data-cell">Name :</th>
                                            <td class="table-data">
                                                <%= data.name %>
                                            </td>
                                        </tr>

                                        <tr>
                                            <th class="data-cell">Mobile No:</th>
                                            <td class="table-data">
                                                <%= data.mobile %>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="data-cell">Address:</th>
                                            <td class="table-data">
                                                <%= data.address %>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="data-cell">StreetAddress:</th>
                                            <td class="table-data">
                                                <%= data.streetaddress %>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="data-cell">City:</th>
                                            <td class="table-data">
                                                <%= data.city %>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="data-cell">State:</th>
                                            <td class="table-data">
                                                <%= data.state %>
                                            </td>
                                        </tr>

                                        <tr>
                                            <th class="data-cell">Pincode:</th>
                                            <td class="table-data">
                                                <%= data.pincode %>
                                            </td>
                                        </tr>
                                        <br />
                                        <tr>
                                            <th class="data-cell">Landmark:</th>
                                            <td class="table-data">
                                                <%= data.landmark %>
                                            </td>
                                        </tr>

                                        <td class="data-cell" style="padding-top: 25px">  
                                            
                                            <a class="check-btn sqr-btn" data-bs-toggle="modal" id="sendId" onclick="sendAddressId('<%= data._id %>')"
                                                data-bs-target="#exampleModal"><i class="fa fa-edit"></i>Edit
                                                Address</a>

                                        </td>
                                    </table>
                                    <%})%>
                                        <%}%>
                        </div>
                    </div>
                    <div class="col-lg-5" style="padding-top: 150px">
                        <div class="your-order-area">
                            <h3>Your order</h3>
                            <div class="your-order-wrap gray-bg-4">
                                <div class="your-order-info-wrap">
                                    <div class="your-order-info">
                                        <ul>
                                            <li>Product <span>Total</span></li>
                                        </ul>
                                    </div>
                                    <% if(cartDetiles.length> 0){ %>
                                        <% cartDetiles[0].products.forEach((data)=>{ %>
                                            <div class="your-order-middle">
                                                <ul>
                                                    <li>
                                                        <%= data.productId.productname %> <span>
                                                                <%= data.productId.productprice %>
                                                            </span>
                                                    </li>

                                                </ul>
                                            </div>
                                            <% })%>
                                                <%}%>
                                                    <div class="your-order-info order-subtotal">
                                                        <ul>
                                                            <li>Subtotal <span>
                                                                    <%= total%>
                                                                </span></li>
                                                        </ul>
                                                    </div>
                                                    <div class="your-order-info order-shipping">
                                                        <ul>
                                                            <li>
                                                                Shipping
                                                                <p>Enter your full address</p>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                    <div class="your-order-info order-total">
                                                        <ul>
                                                            <li>Total <span>
                                                                    <%= total%>
                                                                </span></li>
                                                        </ul>
                                                    </div>
                                </div>
                                <div class="payment-method">
                                    <div class="pay-top sin-payment">
                                        <input id="payment_method_1" class="input-radio" type="radio" value="cheque"
                                            checked="checked" name="payment_method" />
                                        <label for="payment_method_1"> Direct Bank Transfer </label>
                                        <div class="payment-box payment_method_bacs">
                                            <p>
                                                Make your payment directly into our bank account. Please
                                                use your Order ID as the payment reference.
                                            </p>
                                        </div>
                                    </div>
                                    <div class="pay-top sin-payment">
                                        <input id="payment-method-2" class="input-radio" type="radio" value="cheque"
                                            name="payment_method" />
                                        <label for="payment-method-2">Check payments</label>
                                        <div class="payment-box payment_method_bacs">
                                            <p>
                                                Make your payment directly into our bank account. Please
                                                use your Order ID as the payment reference.
                                            </p>
                                        </div>
                                    </div>
                                    <div class="pay-top sin-payment">
                                        <input id="payment-method-3" class="input-radio" type="radio" value="cheque"
                                            name="payment_method" />
                                        <label for="payment-method-3">Cash on delivery </label>
                                        <div class="payment-box payment_method_bacs">
                                            <p>
                                                Make your payment directly into our bank account. Please
                                                use your Order ID as the payment reference.
                                            </p>
                                        </div>
                                    </div>
                                    <div class="pay-top sin-payment sin-payment-3">
                                        <input id="payment-method-4" class="input-radio" type="radio" value="cheque"
                                            name="payment_method" />
                                        <label for="payment-method-4">PayPal
                                            <img alt=""
                                                src="/userpublic/indexassets/assets/images/icon-img/payment.png" /><a
                                                href="#">What is PayPal?</a></label>
                                        <div class="payment-box payment_method_bacs">
                                            <p>
                                                Make your payment directly into our bank account. Please
                                                use your Order ID as the payment reference.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="Place-order btn-hover">
                                <a href="#">Place Order</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!----------------------------------------------------------------- Moda --------------------------------------------------------------->
        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Edit Your Address</h5>
                        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close"
                            style="border: none;">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                   
                    
                       
                    <form  > 
                        <div class="modal-body">
                            <div class="different-address open-toggle mt-30">
                                <div class="row">
                                    <div class="col-lg-6 col-md-6">
                                        <div class="billing-info mb-20">
                                            <label>User Name</label>
                                            <input type="text" placeholder="(Name)*" id="username1"  name="username"  />
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-6">
                                        <div class="billing-info mb-20">
                                            <label>Mobile Number</label>
                                            <input type="text" placeholder="(10 Digits )*"  id="usermobile1" name="usermobile" />
                                        </div>
                                    </div>
                                    <div class="col-lg-12">
                                        <div class="billing-info mb-20">
                                            <label>Address</label>
                                            <input type="text" placeholder="(House No. Building Name)*"  id="address1" name="address" />
                                        </div>
                                    </div>

                                    <div class="col-lg-12">
                                        <div class="billing-info mb-20">
                                            <label>Street Address</label>

                                            <input placeholder="(Road name,Area, colony)*" type="text"id="streetaddress1" name="streetaddress" />
                                        </div>
                                    </div>
                                    <div class="col-lg-12">
                                        <div class="billing-info mb-20">
                                            <label>City</label>
                                            <input type="text"   placeholder="(your city)*"  id="city1"  name="city"  />
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-6">
                                        <div class="billing-info mb-20">
                                            <label>Pincode</label>
                                            <input type="text"   placeholder="(Required)*"  id="pincode1" name="pincode" />
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-6">
                                        <div class="billing-info mb-20">
                                            <label>State</label>
                                            <input type="text" placeholder="(State)*"   id="state1" name="state" />
                                        </div>
                                    </div>
                                    <div class="col-lg-12 col-md-12">
                                        <div class="billing-info mb-20">
                                            <label>Landmark</label>
                                            <input type="text" placeholder="(Famous place your Area)*" id="landmark1"  name="landmark" />
                                        </div>
                                    </div>


                                </div>
                            </div>

                            
                            <div class="modal-footer">
                               
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button  class="green"  onclick="updateAddress()" >Save changes</button>
                                
                            </div>
                        </div>
                        
                </div>
            </div>
            </form>
            
           
        </div>
        <!-----------------------------------------------------------------End  Moda --------------------------------------------------------------->


    <script>
       
    let addressId;
             function sendAddressId(id) {
            

            fetch(`/checkoutpage/${id}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ id }),
            })
                .then((response) => {
                    if (!response.ok) {
                        throw new Error("Network response was not ok");
                    }
                    return response.json();
                })
                .then((data) => {
                    console.log(data)
                    document.getElementById("username1").value = data.addressDataSecond.name
                    document.getElementById("usermobile1").value = data.addressDataSecond.mobile
                    document.getElementById("pincode1").value = data.addressDataSecond.pincode
                    document.getElementById("address1").value = data.addressDataSecond.address
                    document.getElementById("streetaddress1").value = data.addressDataSecond.streetaddress
                    document.getElementById("city1").value = data.addressDataSecond.city
                    document.getElementById("state1").value = data.addressDataSecond.state
                    document.getElementById("landmark1").value = data.addressDataSecond.landmark
                    addressId = data.addressDataSecond._id
                  
                    
                })

                .catch((err) => {
                    console.log(err);
                });
        }



        function updateAddress() {
            console.log("uuuu");
           

          let username = document.getElementById("username1").value;
          let usermobile = document.getElementById("usermobile1").value
          let address = document.getElementById("address1").value;
          let streetaddress = document.getElementById("streetaddress1").value;
          let pincode = document.getElementById("pincode1").value;
          let state = document.getElementById("state1").value;
          let landmark = document.getElementById("landmark1").value;
          let city = document.getElementById("city1").value;
         // let addressId = document.getElementById("addressId1").value
                
           
      
          fetch('/checkoutpage', {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({addressId,username,usermobile,address,streetaddress,pincode,state,landmark,city}),
          })
            .then((response) => {
              if (!response.ok) {
                throw new Error("Network response was not ok");
              }
              return response.json();
            })
            .then((data) => {
                
              if  (data.success) {
                
                window.location.reload()
               
                
              } else {
                message.innerHTML = "Somthing wrong";
              }
            })
      
            .catch((err) => {
              console.log(err);
            });
        }
        </script>



        <%- include('../partials/mainfooter.ejs')%>