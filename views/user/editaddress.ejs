<%- include('../partials/mainheader.ejs')%>
    <style>
        .error-message {
            color: red;
            font-weight: 600;
        }
    </style>



    <p id="msg4" class="text-danger"
        style="color: red; justify-content: center; align-items: center; display: flex; font-weight: 600;"></p>

    <div class="col-lg-9 col-md-8" style="margin-left: 14%; padding-top: 50px;">
        <div class="tab-content" id="myaccountContent">


            <!-- Single Tab Content Start -->
            <div class="tab-pane fade show active" id="dashboad" role="tabpanel">
                <div class="myaccount-content">
                    <h3>Add Your New Address</h3>
                    <div class="account-details-form">
                        <div>
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="single-input-item">
                                        <label for="first-name" class="required">User Name</label>
                                        <input type="text" id="username" name="username"
                                            value="<%=  addressData.name %>" />
                                        <span id="usernameError" class="error-message"></span>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="single-input-item">
                                        <label for="last-name" class="required">Mobile Number</label>
                                        <input type="number" id="usermobile" name="usermobile"
                                            value="<%=  addressData.mobile %>" />
                                        <span id="usermobileError" class="error-message"></span>

                                    </div>
                                </div>
                            </div>
                            <fieldset>
                                <legend>Local Address</legend>
                                <div class="single-input-item">
                                    <label for="current-pwd" class="required">Address</label>
                                    <input type="text" id="address" name="address"
                                        value="<%=  addressData.address %>" />
                                    <span id="addressError" class="error-message"></span>

                                </div>
                                <div class="single-input-item">
                                    <label for="current-pwd" class="required">Street Address</label>
                                    <input type="text" id="streetaddress" name="streetaddress"
                                        value="<%=  addressData.streetaddress %>" />
                                    <span id="streetaddressError" class="error-message"></span>

                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="single-input-item">
                                            <label for="new-pwd" class="required">Pincode</label>
                                            <input type="number" id="pincode" name="pincode"
                                                value="<%=  addressData.pincode %>" />
                                            <span id="pincodeError" class="error-message"></span>

                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="single-input-item">
                                            <label for="confirm-pwd" class="required">City</label>
                                            <input type="text" id="city" name="city" value="<%=  addressData.city %>" />
                                            <span id="cityError" class="error-message"></span>

                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="single-input-item">
                                            <label for="new-pwd" class="required">State</label>
                                            <input type="text" id="state" name="state"
                                                value="<%=  addressData.state %>" />
                                            <span id="stateError" class="error-message"></span>

                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="single-input-item">
                                            <label for="confirm-pwd" class="required">Landmark</label>
                                            <input type="text" id="landmark" name="landmark"
                                                value="<%=  addressData.landmark %>" />
                                            <span id="landmarkError" class="error-message"></span>

                                        </div>
                                    </div>

                                </div>
                            </fieldset>
                            <div class="single-input-item btn-hover">

                                <button onclick="updateAddress('<%= addressData._id %>')"
                                    class="check-btn sqr-btn">Update Address</button>

                            </div>
                        </div>
                    </div>
                </div>
            </div>





        </div>
    </div> <!-- My Account Tab Content End -->

    <!-- my account wrapper end -->
    <script>
        function updateAddress(id) {

            let username = document.getElementById("username").value;
            console.log("ddddddddddddd", username)

            let usermobile = document.getElementById("usermobile").value;
            let address = document.getElementById("address").value;
            let streetaddress = document.getElementById("streetaddress").value;
            let pincode = document.getElementById("pincode").value;
            let state = document.getElementById("state").value;
            let landmark = document.getElementById("landmark").value;
            let city = document.getElementById("city").value;
            let message = document.getElementById("msg4");

            var username1 = document.getElementById('username').value.trim();
            if (!username1.match(/^[A-Za-z]+$/)) {
                document.getElementById('usernameError').textContent = 'Username can only contain letters!';
                return false;
            } else {
                document.getElementById('usernameError').textContent = '';
            }

            // Mobile Number validation
            var usermobile1 = document.getElementById('usermobile').value.trim();
            if (!usermobile1.match(/^\d+$/)) {
                document.getElementById('usermobileError').textContent = 'Mobile number can only contain numbers!';
                return false;
            } else if (usermobile.length !== 10) {
                document.getElementById('usermobileError').textContent = 'Mobile number must be 10 digits long!';
                return false;
            } else {
                document.getElementById('usermobileError').textContent = '';
            }

            // Address validation
            var address1 = document.getElementById('address').value.trim();
            if (!address1) {
                document.getElementById('addressError').textContent = 'Address is required!';
                return false;
            } else {
                document.getElementById('addressError').textContent = '';
            }

            // Street Address validation
            var streetaddress1 = document.getElementById('streetaddress').value.trim();
            if (!streetaddress1) {
                document.getElementById('streetaddressError').textContent = 'Street address is required!';
                return false;
            } else {
                document.getElementById('streetaddressError').textContent = '';
            }

            // Pincode validation
            var pincode1 = document.getElementById('pincode').value.trim();
            if (!pincode1.match(/^\d+$/)) {
                document.getElementById('pincodeError').textContent = 'Pincode can only contain numbers!';
                return false;
            } else if (pincode.length !== 6) {
                document.getElementById('pincodeError').textContent = 'Pincode must be 6 digits long!';
                return false;
            } else {
                document.getElementById('pincodeError').textContent = '';
            }

            // City validation
            var city1 = document.getElementById('city').value.trim();
            if (!city1) {
                document.getElementById('cityError').textContent = 'City is required!';
                return false;
            } else {
                document.getElementById('cityError').textContent = '';
            }

            // State validation
            var state1 = document.getElementById('state').value.trim();
            if (!state1) {
                document.getElementById('stateError').textContent = 'State is required!';
                return false;
            } else {
                document.getElementById('stateError').textContent = '';
            }

            // Landmark validation
            var landmark1 = document.getElementById('landmark').value.trim();
            if (!landmark1) {
                document.getElementById('landmarkError').textContent = 'Landmark is required!';
                return false;
            } else {
                document.getElementById('landmarkError').textContent = '';
            }






            fetch(`/edituseraddress/${id}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ username, usermobile, address, streetaddress, pincode, city, landmark, state }),
            })
                .then((response) => {
                    if (!response.ok) {
                        throw new Error("Network response was not ok");
                    }
                    return response.json();
                })
                .then((data) => {

                    if (data.already) {
                        message.innerHTML = data.already;
                    } else if (data.success) {
                        // Show success message using SweetAlert
                        Swal.fire({
                            title: 'Success!',
                            text: 'Address updated successfully',
                            icon: 'success',
                            timer: 3000, // Display for 3 seconds
                            onClose: () => {
                                window.location.href = "/userprofile";
                            }
                        });
                    } else {
                        message.innerHTML = "Something wrong";
                    }
                })

                .catch((err) => {
                    console.log(err);
                });

        }
    </script>



    <%- include('../partials/mainfooter.ejs')%>