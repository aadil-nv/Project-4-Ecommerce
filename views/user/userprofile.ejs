<%- include('../partials/mainheader.ejs')%>




    <!-- my account wrapper start -->
    <div class="my-account-wrapper pb-30 pt-30">
        <div class="container" style=" padding-top: 25px;">

            <p id="errorMessage1" style="justify-content: center; align-items: center; display: flex; color: red;">
                <%=locals.added %>
            </p>
            <% if(typeof message!=='undefined' ){ %>

                <p id="errorMessage2" style="color: red;"
                    style="justify-content: center; align-items: center; display: flex;">
                    <%= message %>
                </p>
                <% } %>

                    <div class="row">
                        <div class="col-lg-12">
                            <!-- My Account Page Start -->
                            <div class="myaccount-page-wrapper">
                                <!-- My Account Tab Menu Start -->
                                <div class="row">
                                    <div class="col-lg-3 col-md-4">
                                        <div class="myaccount-tab-menu nav" role="tablist">
                                            <a href="#dashboad" class="active" data-bs-toggle="tab">Profile</a>
                                            <a href="#orders" data-bs-toggle="tab">Orders</a>
                                            <a href="#download" data-bs-toggle="tab">Download</a>
                                            <a href="#payment-method" data-bs-toggle="tab">Payment Method</a>
                                            <a href="#address-edit" data-bs-toggle="tab">Address</a>
                                            <a href="#account-info" data-bs-toggle="tab" id="detiles">Change
                                                Password</a>
                                            <a href="/logout" onclick="return confirm(event)" id="logout">Logout</a>
                                        </div>
                                    </div>
                                    <!-- My Account Tab Menu End -->

                                    <!-- My Account Tab Content Start -->
                                    <div class="col-lg-9 col-md-8">
                                        <div class="tab-content" id="myaccountContent">
                                            <!-- Single Tab Content Start -->
                                            <div class="tab-pane fade show active" id="dashboad" role="tabpanel">
                                                <div class="myaccount-content">
                                                    <h3>Dashboard</h3>
                                                    <div class="welcome">

                                                        <h6>Name : <%= userData.name %>
                                                        </h6>
                                                        <h6>Email : <%= userData.email %>
                                                        </h6>
                                                        <h6>Mobile : <%= userData.mobile %>
                                                        </h6>
                                                    </div>

                                                    <div class="single-input-item btn-hover" style="padding-top: 50PX;">
                                                        <button class="check-btn sqr-btn"
                                                            style="background-color: #e97730; width: 130PX; height: 40PX; border: none; color: aliceblue; "><a
                                                                href="/edituserdetiles">Edit detiles</a></a></button>
                                                    </div>





                                                </div>


                                            </div>


                                            <!-- Single Tab Content End -->
                                            <!-- Single Tab Content Start -->
                                            <div class="tab-pane fade" id="orders" role="tabpanel">
                                                <div class="myaccount-content">
                                                    <h3>Orders</h3>
                                                    <div class="myaccount-table table-responsive text-center">
                                                        <table class="table table-bordered">
                                                            <thead class="thead-light">
                                                                <tr>
                                                                    <th>Order</th>
                                                                    <th>Date</th>
                                                                    <th>Status</th>
                                                                    <th>Total</th>
                                                                    <th>Action</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr>
                                                                    <td>1</td>
                                                                    <td>Aug 22, 2022</td>
                                                                    <td>Pending</td>
                                                                    <td>$3000</td>
                                                                    <td><a href="cart.html"
                                                                            class="check-btn sqr-btn ">View</a>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>2</td>
                                                                    <td>July 22, 2022</td>
                                                                    <td>Approved</td>
                                                                    <td>$200</td>
                                                                    <td><a href="cart.html"
                                                                            class="check-btn sqr-btn ">View</a>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>3</td>
                                                                    <td>June 12, 2017</td>
                                                                    <td>On Hold</td>
                                                                    <td>$990</td>
                                                                    <td><a href="cart.html"
                                                                            class="check-btn sqr-btn ">View</a>
                                                                    </td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Single Tab Content End -->
                                            <!-- Single Tab Content Start -->
                                            <div class="tab-pane fade" id="download" role="tabpanel">
                                                <div class="myaccount-content">
                                                    <h3>Downloads</h3>
                                                    <div class="myaccount-table table-responsive text-center">
                                                        <table class="table table-bordered">
                                                            <thead class="thead-light">
                                                                <tr>
                                                                    <th>Product</th>
                                                                    <th>Date</th>
                                                                    <th>Expire</th>
                                                                    <th>Download</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr>
                                                                    <td>Haven - Free Real Estate PSD Template</td>
                                                                    <td>Aug 22, 2022</td>
                                                                    <td>Yes</td>
                                                                    <td><a href="#" class="check-btn sqr-btn "><i
                                                                                class="fa fa-cloud-download"></i>
                                                                            Download
                                                                            File</a></td>
                                                                </tr>
                                                                <tr>
                                                                    <td>HasTech - Profolio Business Template</td>
                                                                    <td>Sep 12, 2022</td>
                                                                    <td>Never</td>
                                                                    <td><a href="#" class="check-btn sqr-btn "><i
                                                                                class="fa fa-cloud-download"></i>
                                                                            Download
                                                                            File</a></td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Single Tab Content End -->
                                            <!-- Single Tab Content Start -->
                                            <div class="tab-pane fade" id="payment-method" role="tabpanel">
                                                <div class="myaccount-content">
                                                    <h3>Payment Method</h3>
                                                    <p class="saved-message">You Can't Saved Your Payment Method yet.
                                                    </p>
                                                </div>
                                            </div>
                                            <!-- Single Tab Content End -->
                                            <!-- Single Tab Content Start -->
                                            <div class="tab-pane fade" id="address-edit" role="tabpanel"
                                                style=" height: 300px;  overflow: scroll;">

                                                <div class="myaccount-content">
                                                    <% if (addressData.length < 6 ){%>
                                                        <a href="/adduseraddress/<%= userData._id %>"
                                                            style="justify-content: end; align-items: end   ;display: flex; margin-top: 25px; "><i
                                                                class="fa-solid fa-square-plus fa-2xl mx-2"></i> </a>
                                                        <%}else{%>
                                                            <a href="/adduseraddress/<%= userData._id %>"
                                                                style="justify-content: end; align-items: end   ;display: flex; margin-top: 25px; display: none;"><i
                                                                    class="fa-solid fa-square-plus fa-2xl mx-2"></i>
                                                            </a>
                                                            <%}%>


                                                                <h3>Billing Address
                                                                </h3>
                                                                <% if(addressData.length> 0){ %>
                                                                    <% addressData.forEach(data=>{%>
                                                                        <table
                                                                            style="width:70% ;  border: 1px dashed rgb(161, 156, 156); background-color: rgb(237, 239, 241);  ">
                                                                            <tr>
                                                                                <th>Name :</th>
                                                                                <td>
                                                                                    <%= data.name %>
                                                                                </td>
                                                                            </tr>

                                                                            <tr>
                                                                                <th>Mobile No:</th>
                                                                                <td>
                                                                                    <%= data.mobile %>
                                                                                </td>
                                                                            </tr>
                                                                            <tr>
                                                                                <th>Address:</th>
                                                                                <td>
                                                                                    <%= data.address %>
                                                                                </td>
                                                                            </tr>
                                                                            <tr>
                                                                                <th>StreetAddress:</th>
                                                                                <td>
                                                                                    <%= data.streetaddress %>
                                                                                </td>
                                                                            </tr>
                                                                            <tr>
                                                                                <th>City:</th>
                                                                                <td>
                                                                                    <%= data.city %>
                                                                                </td>
                                                                            </tr>
                                                                            <tr>
                                                                                <th>State:</th>
                                                                                <td>
                                                                                    <%= data.state %>
                                                                                </td>
                                                                            </tr>
                                                                            <tr>
                                                                                <th>Pincode:</th>
                                                                                <td>
                                                                                    <%= data.pincode %>
                                                                                </td>
                                                                            </tr><br>
                                                                            <tr>
                                                                                <th>Landmark:</th>
                                                                                <td>
                                                                                    <%= data.landmark %>
                                                                                </td>
                                                                            </tr>

                                                                            <td style="padding-top: 25px; "><a
                                                                                    href="/edituseraddress/<%= data._id %>"
                                                                                    class="check-btn sqr-btn "><i
                                                                                        class="fa fa-edit"></i>Edit
                                                                                    Address</a>
                                                                            </td>

                                                                            <td style="padding-top: 25px;">


                                                                                <button class="check-btn sqr-btn "
                                                                                    onclick="confirmdelete('<%= data._id %>')"
                                                                                    style="border: none;"><i
                                                                                        class="fa-solid fa-trash mx-1"></i>Delete
                                                                                    Address</button>


                                                                            </td>

                                                                        </table>
                                                                        <%})%>
                                                                            <%}%>





                                                </div>
                                            </div>
                                            <!-- Single Tab Content End -->
                                            <!-- Single Tab Content Start -->
                                            <div class="tab-pane fade" id="account-info" role="tabpanel">

                                                <p id="msg2" class="text-danger"
                                                    style="justify-content:  center; align-items: center; display: flex;">
                                                </p>


                                                <div class="myaccount-content">
                                                    <h3>Change Your Password</h3>
                                                    <div class="account-details-form">
                                                        <form action="#">
                                                            <div class="row">
                                                                <div class="col-lg-6">
                                                                    <div class="single-input-item">
                                                                        <label for="first-name" class="required">Old
                                                                            Password
                                                                        </label>
                                                                        <input type="password" id="Old-Password"
                                                                            name="oldpassword" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-6">
                                                                    <div class="single-input-item">
                                                                        <label for="last-name" class="required">New
                                                                            Password</label>
                                                                        <input type="password" id="New-Password"
                                                                            name="newpassword" />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="single-input-item btn-hover">
                                                                <input type="hidden" name="id"
                                                                    value="<%= userData._id %>" />

                                                                <button class="check-bt sqr-btn"> <a href="#"
                                                                        onclick="editPass('<%= userData._id %>')">Save
                                                                        Changes</a> </button>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>


                                            
                                        </div>
                                    </div> 
                                </div>
                            </div>
                        </div>
                    </div>
        </div>
    </div>




    <script>
        function confirmdelete(id) {
            Swal.fire({
                title: "Are you sure?",
                text: "You won't be able to revert this!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Yes, delete it!"
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire({
                        title: "Deleted!",
                        text: "Your file has been deleted.",
                        icon: "success"
                    });
                    console.log("Id fetch : ", id);
                    fetch(`/deleteaddress/${id}`, {
                        method: "DELETE",
                        headers: { "Content-Type": "application/json" },
                    })
                        .then((response) => {
                            console.log("response ; ", response);
                            return response.json();
                        })
                        .then((data) => {
                            window.location.reload();
                        })
                        .catch((err) => {
                            console.log(err);
                        });
                } else {

                    console.log("Deletion cancelled.");
                }
            });
        }
    </script>




    <script>

        setTimeout(function () {
            var errorMessage = document.getElementById('errorMessage1');
            if (errorMessage) {
                errorMessage.remove();
            }
        }, 2000); 
    </script>
    <script>

        setTimeout(function () {
            var errorMessage = document.getElementById('errorMessage2');
            if (errorMessage) {
                errorMessage.remove();
            }
        }, 2000); 
    </script>

    <script>
        function editPass(id) {
            console.log(id)
            let oldpassword = document.getElementById("Old-Password").value;
            let newpassword = document.getElementById("New-Password").value;
            let message = document.getElementById("msg2");




            fetch(`/userprofile/${id}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ oldpassword, newpassword }),
            })
                .then((response) => {
                    if (!response.ok) {
                        throw new Error("Network response was not ok");
                    }
                    return response.json();
                })
                .then((data) => {
                    if (data.already) {
                        message.innerHTML = data.already;
                    } else if (data.success) {
                        window.location.href = "/userprofile";
                    } else {
                        message.innerHTML = "Somthing wrong";
                    }
                })

                .catch((err) => {
                    console.log(err);
                });
        }
    </script>









    <%- include('../partials/mainfooter.ejs')%>