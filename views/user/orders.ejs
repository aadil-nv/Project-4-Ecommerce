<%- include('../partials/mainheader.ejs')%>
    <style>
        #orderid {
            color: black;
            font-weight: 600;
            align-items: start;
            display: block;
            padding-left: 50px;
            padding-top: 30px;
        }

        #table-main {
            padding-bottom: 300px;
        }

        #button-user {
            background-color: red;
            color: white;
            width: 90px;
            height: 35px;
            border: none;
            border-radius: 30px;
        }

        #table {
            border-radius: 30px;
        }
    </style>

    <div class="breadcrumb-area bg-gray-4 breadcrumb-padding-1" style="background-color: rgb(206, 206, 235)">
        <h1 id="orderid">#order id here</h1>

        <div class="banner-area pb-70 pt-80">
            <div class="container" style="height: 600px">
                <div class="row">
                    <div class="col-lg-12 col-md-6 col-12">
                        <div class="col-lg-6 col-md-6 mb-lg-0 mb-15">
                            <span>
                                <i class="material-icons md-calendar_today"></i>
                                <b>Wed, Aug 13, 2020, 4:34PM</b>
                            </span>
                            <br />
                            <small class="text-muted">Order ID: 3453012</small>
                        </div>

                        <table class="table table-bordered">
                            <thead class="thead-light" id="table">
                                <tr>
                                    <th>Product Image</th>
                                    <th>Product Name</th>
                                    <th>Quantity</th>
                                    <th>Total Price</th>

                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            
                           
                            <% if(orderData.length> 0){ %>
                                <% orderData.forEach((item)=> { %>
                                    
                                        <input type="hidden" value="<%= item._id%>" id="orderId" name="orderId">
                                    <%item.orderedItem.forEach((product)=> { %>

                                        <tbody>
                                            <tr>
                                                <td>
                                                    <img src="/uploads/<%=product.productId.productimage[0] %>"
                                                        width="200px" class="rounded-3" />
                                                </td>
                                                <td>
                                                    <%=product.productId.productname %>
                                                </td>
                                                <td>
                                                    <%=product.quantity %>
                                                </td>
                                                <td>
                                                    <%=product.totalProductAmount %>
                                                </td>

                                                <td>
                                                    <%=product.productStatus %>
                                                </td>
                                                <% if(product.productStatus==="Order Cancelled") {%>
                                               
                                                    <td>
                                                        <p>Order canceld you ? Need Help</p>
                                                       
                                                    </td>
                                                    <%}else if(product.productStatus==="Delivered"){%>
                                                        <td>
                                                            <p>Order Alredy Delivered? Need Help</p>
                                                           
                                                        </td>


                                                        <%}else{%>
                                                    <td>
                                                        <button id="button-user"
                                                            data-product-id="<%= product.productId._id %>"
                                                            onclick="cancelOrder(this)"  >
                                                            Cancel
                                                        </button>
                                                    </td>
                                                    <%}%>
                                            </tr>
                                        </tbody>
                                        <% }); %>
                                            <% }); %>
                                                <% }%>
                        </table>
                        <div class="row">
                            <div class="col-6">
                                <table class="table table-bordered">
                                    <thead class="thead-light" id="table">
                                        <tr>
                                            <th>Delivery Address</th>
                                        </tr>
                                    </thead>

                                    <tbody>
                                        <% orderData.forEach((item)=> { %>
                                            <tr>
                                                <td>
                                                    Name :<%= item.deliveryAddress.name %> <br />
                                                        Mobile :<%= item.deliveryAddress.mobile %><br />
                                                            Pincode:<%= item.deliveryAddress.pincode %><br />
                                                                Address :<%= item.deliveryAddress.address %><br />
                                                                    StreetAddress<%= item.deliveryAddress.streetaddress
                                                                        %><br />
                                                                        City :<%= item.deliveryAddress.city %><br />
                                                                            State:<%= item.deliveryAddress.state %>
                                                                                <br />
                                                                                Landmark :<%=
                                                                                    item.deliveryAddress.landmark %>
                                                </td>
                                            </tr>
                                            <% }); %>
                                    </tbody>
                                </table>
                            </div>
                            <div class="col-6">
                                <table class="table table-bordered">
                                    <thead class="thead-light" id="table">
                                        <tr>
                                            <th>Payment Detiles</th>
                                        </tr>
                                    </thead>

                                    <tbody>
                                        <% orderData.forEach((item)=> { %>
                                            <tr>
                                                <td>
                                                    <%= item.paymentMethod %>
                                                </td>
                                            </tr>
                                            <% }); %>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="related-product-area pb-95 pt-100">
        <div class="container">
            <div class="section-title-2 st-border-center text-center mb-75" data-aos="fade-up" data-aos-delay="200">
                <h2>Related Products</h2>
            </div>
            <div class="related-product-active swiper-container">
                <div class="swiper-wrapper">
                    <div class="swiper-slide">
                        <div class="product-wrap" data-aos="fade-up" data-aos-delay="200">
                            <div class="product-img img-zoom mb-25">
                                <a href="product-details.html">
                                    <img src="/userpublic/indexassets/assets/images/product/product-1.png" alt="" />
                                </a>
                                <div class="product-badge badge-top badge-right badge-pink">
                                    <span>-10%</span>
                                </div>
                                <div class="product-action-wrap">
                                    <button class="product-action-btn-1" title="Wishlist">
                                        <i class="pe-7s-like"></i>
                                    </button>
                                    <button class="product-action-btn-1" title="Quick View" data-bs-toggle="modal"
                                        data-bs-target="#exampleModal">
                                        <i class="pe-7s-look"></i>
                                    </button>
                                </div>
                                <div class="product-action-2-wrap">
                                    <button class="product-action-btn-2" title="Add To Cart">
                                        <i class="pe-7s-cart"></i> Add to cart
                                    </button>
                                </div>
                            </div>
                            <div class="product-content">
                                <h3><a href="product-details.html">New Modern Sofa Set</a></h3>
                                <div class="product-price">
                                    <span class="old-price">$25.89 </span>
                                    <span class="new-price">$20.25 </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="swiper-slide">
                        <div class="product-wrap" data-aos="fade-up" data-aos-delay="400">
                            <div class="product-img img-zoom mb-25">
                                <a href="product-details.html">
                                    <img src="/userpublic/indexassets/assets/images/product/product-2.png" alt="" />
                                </a>
                                <div class="product-action-wrap">
                                    <button class="product-action-btn-1" title="Wishlist">
                                        <i class="pe-7s-like"></i>
                                    </button>
                                    <button class="product-action-btn-1" title="Quick View" data-bs-toggle="modal"
                                        data-bs-target="#exampleModal">
                                        <i class="pe-7s-look"></i>
                                    </button>
                                </div>
                                <div class="product-action-2-wrap">
                                    <button class="product-action-btn-2" title="Add To Cart">
                                        <i class="pe-7s-cart"></i> Add to cart
                                    </button>
                                </div>
                            </div>
                            <div class="product-content">
                                <h3><a href="product-details.html">New Modern Sofa Set</a></h3>
                                <div class="product-price">
                                    <span>$50.25 </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="swiper-slide">
                        <div class="product-wrap" data-aos="fade-up" data-aos-delay="600">
                            <div class="product-img img-zoom mb-25">
                                <a href="product-details.html">
                                    <img src="/userpublic/indexassets/assets/images/product/product-3.png" alt="" />
                                </a>
                                <div class="product-badge badge-top badge-right badge-pink">
                                    <span>-10%</span>
                                </div>
                                <div class="product-action-wrap">
                                    <button class="product-action-btn-1" title="Wishlist">
                                        <i class="pe-7s-like"></i>
                                    </button>
                                    <button class="product-action-btn-1" title="Quick View" data-bs-toggle="modal"
                                        data-bs-target="#exampleModal">
                                        <i class="pe-7s-look"></i>
                                    </button>
                                </div>
                                <div class="product-action-2-wrap">
                                    <button class="product-action-btn-2" title="Add To Cart">
                                        <i class="pe-7s-cart"></i> Add to cart
                                    </button>
                                </div>
                            </div>
                            <div class="product-content">
                                <h3><a href="product-details.html">Easy Modern Chair</a></h3>
                                <div class="product-price">
                                    <span class="old-price">$45.00 </span>
                                    <span class="new-price">$40.00 </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="swiper-slide">
                        <div class="product-wrap" data-aos="fade-up" data-aos-delay="800">
                            <div class="product-img img-zoom mb-25">
                                <a href="product-details.html">
                                    <img src="/userpublic/indexassets/assets/images/product/product-4.png" alt="" />
                                </a>
                                <div class="product-action-wrap">
                                    <button class="product-action-btn-1" title="Wishlist">
                                        <i class="pe-7s-like"></i>
                                    </button>
                                    <button class="product-action-btn-1" title="Quick View" data-bs-toggle="modal"
                                        data-bs-target="#exampleModal">
                                        <i class="pe-7s-look"></i>
                                    </button>
                                </div>
                                <div class="product-action-2-wrap">
                                    <button class="product-action-btn-2" title="Add To Cart">
                                        <a href="#" onclick=""><i class="pe-7s-cart"></i>Add To Cart</a>
                                    </button>
                                </div>
                            </div>
                            <div class="product-content">
                                <h3><a href="product-details.html">Stylish Swing Chair</a></h3>
                                <div class="product-price">
                                    <span>$30.25 </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="swiper-slide">
                        <div class="product-wrap">
                            <div class="product-img img-zoom mb-25">
                                <a href="product-details.html">
                                    <img src="/userpublic/indexassets/assets/images/product/product-2.png" alt="" />
                                </a>
                                <div class="product-badge badge-top badge-right badge-pink">
                                    <span>-10%</span>
                                </div>
                                <div class="product-action-wrap">
                                    <button class="product-action-btn-1" title="Wishlist">
                                        <i class="pe-7s-like"></i>
                                    </button>
                                    <button class="product-action-btn-1" title="Quick View" data-bs-toggle="modal"
                                        data-bs-target="#exampleModal">
                                        <i class="pe-7s-look"></i>
                                    </button>
                                </div>
                                <div class="product-action-2-wrap">
                                    <button class="product-action-btn-2" title="Add To Cart">
                                        <i class="pe-7s-cart"></i> Add to cart
                                    </button>
                                </div>
                            </div>
                            <div class="product-content">
                                <h3><a href="product-details.html">New Modern Sofa Set</a></h3>
                                <div class="product-price">
                                    <span class="old-price">$80.50 </span>
                                    <span class="new-price">$75.25 </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

    <script>
        async function cancelOrder(button) {
            const productId = button.getAttribute("data-product-id");
            const orderId = document.getElementById('orderId').value
                console.log("--------------orderid is +++   ----------------------------",orderId)
            // Display a SweetAlert confirmation dialog
            Swal.fire({
                title: "Are you sure?",
                text: "This action cannot be undone!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "Yes, cancel it!",
                cancelButtonText: "No, keep it",
            }).then(async (result) => {
                if (result.isConfirmed) {
                    try {
                        const response = await fetch(`/ordersone/${productId}`, {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({ productId: productId ,orderId}),
                        });

                        if (!response.ok) {
                            throw new Error("Network response was not ok");
                        }

                        // Optionally, perform any additional actions after successful cancellation
                        window.location.reload();
                    } catch (error) {
                        console.error(error);
                        // Optionally, display an error message to the user
                    }
                } else {
                    // Action cancelled by user
                    console.log("Action cancelled");
                }
            });
        }
    </script>

    <%- include('../partials/mainfooter.ejs')%>